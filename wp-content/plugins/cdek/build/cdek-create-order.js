(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var a in r)e.o(r,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:r[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.jQuery;var r=e.n(t);const a=window.wp.apiFetch;var d=e.n(a);r()(document).ready((function(){let e=[];function t(){const e=r()("#cdek-status-block").data("status-available");void 0===e||e||(r()("#order_data").find('input[name="order_date"]').attr("disabled",!0),r()("#order_data").find('input[name="order_date_hour"]').attr("disabled",!0),r()("#order_data").find('input[name="order_date_minute"]').attr("disabled",!0),r()("#order_data").find('select[name="customer_user"]').attr("disabled",!0),r()("#order_data").find('a[class="edit_address"]').hide())}t(),r()("#selected_product").change((function(){let e=r()("#selected_product").val();r()("#product_"+e).css("display","flex")})),r()("#save_package").click((function(){r()("#package_list").show();let t={};if(t.length=r()("input[name=package_length]").val(),t.width=r()("input[name=package_width]").val(),t.height=r()("input[name=package_height]").val(),t.items=[],r()(".product_list").each((function(e,a){"none"!==r()(a).css("display")&&t.items.push({id:r()(a).find("input[name=product_id]").val(),name:r()(a).find("input[type=text]").val(),quantity:r()(a).find("input[type=number]").val()})})),function(e){return""===e.length?(alert("Не задана длина упаковки"),!1):""===e.width?(alert("Не задана ширина упаковки"),!1):""===e.height?(alert("Не задана высота упаковки"),!1):0!==e.items.length||(alert("Не добавлены товары в упаковку"),!1)}(t)){e.push(t);let a="";a=`Упаковка №${e.length} (${t.length}х${t.width}х${t.height}):`,t.items.forEach((function(e){a+=`${e.name} х${e.quantity}, `})),r()("#package_list").append(`<p>${a.slice(0,-2)}</p>`),r()(".product_list").each((function(e,t){if("none"!==r()(t).css("display")){let e=r()(t).find("input[type=number]").attr("max")-r()(t).find("input[type=number]").val();0!==e?r()(t).find("input[type=number]").attr("max",e):r()("#selected_product option").each((function(e,a){r()(a).text()===r()(t).find("input[type=text]").val()&&r()(a).remove()}))}})),r()("#selected_product").val(-1),r()(".product_list").each((function(e,t){r()(t).find("input[type=number]").val(1),r()(t).css("display","none"),r()("input[name=package_length]").val(""),r()("input[name=package_width]").val(""),r()("input[name=package_height]").val("")})),1===r()("#selected_product option").length&&(r()("#setting_block").hide(),r()("#save_package_btn_block").hide(),r()("#send_package_btn_block").show())}})),r()("#send_package").click((function(t){r()("#cdek-loader").show(),d()({method:"POST",url:t.target.dataset.action,data:{packages:e}}).then((e=>{e.state?(e.door&&(r()("#cdek-courier-result-block").hide(),r()("#cdek-order-courier").show()),r()("#cdek-create-order-form").hide(),r()("#cdek-order-number").html(`№ <b>${e.code}</b>`),r()("#cdek-order-number-input").val(e.code),r()("#cdek-info-order").show()):r()("#cdek-create-order-error").text(e.message).show()})).catch((e=>console.error(e))).finally((()=>r()("#cdek-loader").hide()))})),r()("#create-order-btn").click((function(e){r()("#cdek-create-order-error").hide(),r()("#cdek-loader").show(),d()({method:"POST",url:e.target.dataset.action,data:{packages:[{length:r()("input[name=package_length]").val(),width:r()("input[name=package_width]").val(),height:r()("input[name=package_height]").val()}]}}).then((e=>{e.state?(e.door&&(r()("#cdek-courier-result-block").hide(),r()("#cdek-order-courier").show()),r()("#cdek-status-block").data("status-available",e.available),t(),r()("#cdek-order-status-block").html(e.statuses),r()("#cdek-create-order-form").hide(),r()("#cdek-order-number").html(`№ <b>${e.code}</b>`),r()("#cdek-order-number-input").val(e.code),r()("#cdek-info-order").show()):r()("#cdek-create-order-error").text(e.message).show()})).catch((e=>console.log(e))).finally((()=>r()("#cdek-loader").hide()))})),r()("#delete-order-btn").click((function(e){e.preventDefault(),r()(e.target).addClass("clicked"),r()("#cdek-create-order-error").hide(),r()("#cdek-courier-error").hide(),r()("#cdek-loader").show(),d()({method:"POST",url:e.target.href}).then((t=>{t.state?(alert(t.message),r()(e.target).removeClass("clicked"),r()("#cdek-create-order-form").show(),r()("#cdek-info-order").hide()):(r()("#cdek-delete-order-error").text(t.message).show(),r()("#delete-order-btn").hide())})).catch((e=>console.error(e))).finally((()=>r()("#cdek-loader").hide()))})),r()("#cdek-courier-send-call").click((function(e){r()("#cdek-courier-error").hide(),r()("#cdek-loader").show(),d()({method:"POST",url:e.target.dataset.action,data:{order_id:r()("input[name=package_order_id]").val(),date:r()("#cdek-courier-date").val(),starttime:r()("#cdek-courier-startime").val(),endtime:r()("#cdek-courier-endtime").val(),name:r()("#cdek-courier-name").val(),phone:r()("#cdek-courier-phone").val(),address:r()("#cdek-courier-address").val(),desc:r()("#cdek-courier-package-desc").val(),comment:r()("#cdek-courier-comment").val(),weight:r()("#cdek-courier-weight").val(),length:r()("#cdek-courier-length").val(),width:r()("#cdek-courier-width").val(),height:r()("#cdek-courier-height").val(),need_call:r()("#cdek-courier-call").prop("checked")}}).then((e=>{e?(r()("#call-courier-form").hide(),r()("#cdek-order-courier").hide(),r()("#cdek-courier-info").text(e.message).show(),r()("#cdek-courier-result-block").show()):r()("#cdek-courier-error").html(e.message).show()})).catch((e=>console.error(e))).finally((()=>r()("#cdek-loader").hide()))})),r()("#cdek-order-courier").click((function(){r()("#call-courier-form").toggle()})),r()("#cdek-courier-delete").click((function(e){r()("#cdek-loader").show(),d()({method:"POST",url:e.target.dataset.action,data:{order_id:r()("input[name=package_order_id]").val()}}).then((e=>{e&&(r()("#cdek-courier-result-block").hide(),r()("#cdek-order-courier").show())})).catch((e=>console.error(e))).finally((()=>r()("#cdek-loader").hide()))})),r()("#cdek-info-order").on("click","#cdek-order-status-btn",(function(e){let t=r()("#cdek-order-status-list"),a=r()("#cdek-btn-arrow-up"),d=r()("#cdek-btn-arrow-down");t.toggle(),a.toggle(!t.is(":visible")),d.toggle(t.is(":visible"))}))}))})();
(()=>{"use strict";var e={n:o=>{var t=o&&o.__esModule?()=>o.default:()=>o;return e.d(t,{a:t}),t},d:(o,t)=>{for(var c in t)e.o(t,c)&&!e.o(o,c)&&Object.defineProperty(o,c,{enumerable:!0,get:t[c]})},o:(e,o)=>Object.prototype.hasOwnProperty.call(e,o)};const o=window.jQuery;var t=e.n(o);const c=window.CDEKWidget;var n=e.n(c);const i=window.lodash,d=t()("#billing_city"),a=t()("#shipping_city");let l=null;""===(d.val()||"")&&""===(a.val()||"")||(console.debug("[CDEK-MAP] City has value, initiating checkout update"),t()(document.body).trigger("update_checkout"));const s=(e,o=null)=>{if(console.debug("[CDEK-MAP] Removing selected office info"),t()(".cdek-office-info").remove(),e.html("Выбрать ПВЗ"),t()(".cdek-office-code").val(""),null!==l&&l.clearSelection(),"string"==typeof o){console.debug("[CDEK-MAP] Rendering error message");const e=t()(".open-pvz-btn");e.prev().text(o),e.remove()}};let r;const p=(e,o,c)=>{t()(".cdek-office-code").val(c.code),r.html("Повторно выбрать ПВЗ");const n=r.parent().children(".cdek-office-info");0===n.length?r.before(`<div class="cdek-office-info">${c.name} - [${c.code}]</div>`):n.html(`${c.name} - [${c.code}]`),t()(".cdek-office-code").data("map-auto-close")&&l.close()},u=(0,i.debounce)((()=>{""!==(t()("#ship-to-different-address-checkbox").is(":checked")?a.val():d.val())&&(console.debug("[CDEK-MAP] City or postcode changed, initiating checkout update"),t()(document.body).trigger("update_checkout"))}),500);t()(document.body).on("input","#billing_city, #billing_postcode, #shipping_city, #shipping_postcode",u).on("updated_checkout",(()=>{null!==l&&(console.debug("[CDEK-MAP] Clearing widget selection"),l.clearSelection())})).on("change",".shipping_method",(()=>{t()(document.body).trigger("update_checkout")})).on("click",".open-pvz-btn",null,(e=>{r=t()(e.target),s(r);const o=r.data("points");return console.debug("[CDEK-MAP] Got points from backend:",o),"object"!=typeof o?(console.error("[CDEK_MAP] backend points not object"),void s(r,"CDEK не смог загрузить список доступных ПВЗ, выберите другой метод доставки")):o.length?(null===l?l=new(n())({apiKey:window.cdek.apiKey,popup:!0,debug:!0,defaultLocation:t()("#ship-to-different-address-checkbox").is(":checked")?a.val():d.val(),officesRaw:o,hideDeliveryOptions:{door:!0},onChoose:p}):(l.updateOfficesRaw(o),l.updateLocation(t()("#ship-to-different-address-checkbox").is(":checked")?a.val():d.val())),void l.open()):(console.warn("[CDEK_MAP] backend points are empty"),void s(r,"По данному направлению нет доступных пунктов выдачи CDEK, выберите другой метод доставки"))}))})();